{"paragraphs":[{"text":"%md\n# Utility to backup your Notebooks to an Object Store Container\n\nThis note contains a script to backup all of your notebooks to an object store container.\n\nWritten by brian.macdonald@oracle.com\n\n","user":"anonymous","dateUpdated":"2018-01-04T15:50:38+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":"true"},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Utility to backup your Notebooks to an Object Store Container</h1>\n<p>This note contains a script to backup all of your notebooks to an object store container.</p>\n<p>Written by <a href=\"mailto:&#98;r&#105;&#x61;&#x6e;&#x2e;&#x6d;&#97;&#x63;&#x64;o&#110;&#x61;&#108;d&#64;&#111;&#114;a&#99;l&#x65;&#46;&#x63;&#x6f;&#109;\">&#98;r&#105;&#x61;&#x6e;&#x2e;&#x6d;&#97;&#x63;&#x64;o&#110;&#x61;&#108;d&#64;&#111;&#114;a&#99;l&#x65;&#46;&#x63;&#x6f;&#109;</a></p>\n</div>"}]},"apps":[],"jobName":"paragraph_1515080980693_-2002283326","id":"20180104-154940_902123458","dateCreated":"2018-01-04T15:49:40+0000","dateStarted":"2018-01-04T15:50:38+0000","dateFinished":"2018-01-04T15:50:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:835"},{"text":"%md\n## Instructions\n\n- Set the parameters (identity domain, etc) for your environment in the first five lines of the following shell paragraph.\n- Make sure the Object Store container exists BEFORE running this script\n- The backup_directory does not need to exist before running this script\n- Then run the following paragraph","user":"anonymous","dateUpdated":"2018-01-04T16:06:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":"true"},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h2>Instructions</h2>\n<ul>\n  <li>Set the parameters (identity domain, etc) for your environment in the first five lines of the following shell paragraph.</li>\n  <li>Make sure the Object Store container exists BEFORE running this script</li>\n  <li>The backup_directory does not need to exist before running this script</li>\n  <li>Then run the following paragraph</li>\n</ul>\n</div>"}]},"apps":[],"jobName":"paragraph_1515081052487_2136784045","id":"20180104-155052_1966318147","dateCreated":"2018-01-04T15:50:52+0000","dateStarted":"2018-01-04T16:06:27+0000","dateFinished":"2018-01-04T16:06:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:836"},{"text":"%sh\n\nexport oss_identity_domain='gse00010212'\nexport oss_username='cloud.admin'\nexport oss_password='putYourPasswordHere'\nexport backup_container='journeyC'\nexport backup_directory='notebook_backup'\n\nlogin_string=\"$(curl -v -s -X GET -H \"X-Storage-User: Storage-\"$oss_identity_domain\":\"$oss_username\"\" -H \"X-Storage-Pass: \"$oss_password\"\" \"https://\"$oss_identity_domain\".storage.oraclecloud.com/auth/v1.0\" --stderr - | grep X-Auth-Token)\"\n\nauth_token=\"$(echo $login_string | sed -n -e 's/^.*X-Auth-Token: //p')\"\n\nnotebooks=\"$( hadoop fs -ls /user/zeppelin/notebook | sed '1d;s/  */ /g' | cut -d\\  -f8 | xargs -n 1 basename)\"\n\nfor arg in $notebooks; do\n  book=\"$(hadoop fs -cat  /user/zeppelin/notebook/$arg/note.json |grep name |tail -1 | sed -e 's/\"name\": \"\\(.*\\)\",/\\1/' | sed -e 's/^[[:space:]]*//' -e 's/[[:space:]]*$//' | sed s/\\ /\\%20/g)\"\n  echo $book \n  rm -f note.json\n  hadoop fs -get  /user/zeppelin/notebook/$arg/note.json \n  curl -v -X PUT -H \"X-Auth-Token: \"$auth_token\"\" -T note.json https://\"$oss_identity_domain\".storage.oraclecloud.com/v1/Storage-\"$oss_identity_domain\"/\"$backup_container\"/\"$backup_directory\"/\"$book\".json\ndone","user":"anonymous","dateUpdated":"2018-01-04T16:06:59+0000","config":{"tableHide":false,"editorSetting":{"language":"sh","editOnDblClick":"false"},"colWidth":12,"editorMode":"ace/mode/sh","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1515080973618_1929649575","id":"20171222-175131_13667333","dateCreated":"2018-01-04T15:49:33+0000","dateStarted":"2018-01-04T16:06:45+0000","dateFinished":"2018-01-04T16:06:55+0000","status":"ABORT","progressUpdateIntervalMs":500,"$$hashKey":"object:837","errorMessage":""},{"text":"%sh\n","user":"anonymous","dateUpdated":"2018-01-04T15:57:26+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":"false"},"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1515081446474_-820858492","id":"20180104-155726_26554421","dateCreated":"2018-01-04T15:57:26+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:838"}],"name":"Extras/Notebook Backup Script","id":"2D273R6WU","angularObjects":{"2D1TJSV9V:shared_process":[],"2D46JFPJG:shared_process":[],"2D2YE91QH:shared_process":[],"2CZX4RY25:shared_process":[],"2D2TS63QB:shared_process":[],"2D2URAWGN:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2CZX56P84:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}